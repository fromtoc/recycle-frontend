(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c36473f"],{"159b":function(e,t,a){var r=a("da84"),i=a("fdbc"),n=a("785a"),s=a("17c2"),o=a("9112"),l=function(e){if(e&&e.forEach!==s)try{o(e,"forEach",s)}catch(t){e.forEach=s}};for(var c in i)i[c]&&l(r[c]&&r[c].prototype);l(n)},"17c2":function(e,t,a){"use strict";var r=a("b727").forEach,i=a("a640"),n=i("forEach");e.exports=n?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},a640:function(e,t,a){"use strict";var r=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&r((function(){a.call(null,t||function(){throw 1},1)}))}},b0c0:function(e,t,a){var r=a("83ab"),i=a("5e77").EXISTS,n=a("9bf2").f,s=Function.prototype,o=s.toString,l=/^\s*function ([^ (]*)/,c="name";r&&!i&&n(s,c,{configurable:!0,get:function(){try{return o.call(this).match(l)[1]}catch(e){return""}}})},cc50:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"price"}},[a("el-breadcrumb",{staticStyle:{"padding-left":"10px","padding-bottom":"10px","font-size":"12px"},attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首頁")]),a("el-breadcrumb-item",[e._v("基本資料")]),a("el-breadcrumb-item",[e._v("廢棄物管理")]),a("el-breadcrumb-item",[e._v("單價維護")])],1),a("el-card",{staticClass:"box-card"},[a("el-row",{attrs:{gutter:6}},[a("el-col",{attrs:{span:4}},[a("el-cascader",{attrs:{size:"small",placeholder:"請選擇分類查詢","change-on-select":!0,props:e.searchSelectProps,options:e.cateories,clearable:""},on:{change:e.selectChange},model:{value:e.categorykeys,callback:function(t){e.categorykeys=t},expression:"categorykeys"}})],1),a("el-col",{attrs:{span:5}},[a("el-input",{staticClass:"input-with-select",attrs:{clearable:"",size:"small",placeholder:"請輸入廢棄物名稱查詢"},on:{clear:e.search},model:{value:e.queryMap.name,callback:function(t){e.$set(e.queryMap,"name",t)},expression:"queryMap.name"}})],1),a("el-col",{attrs:{span:8}},[a("span",{staticStyle:{margin:"0 10px"}},[e._v("適用月份")]),a("el-date-picker",{attrs:{size:"small",type:"month",placeholder:"選擇適用月份","value-format":"yyyy-MM"},on:{change:e.search},model:{value:e.queryMap.validMonth,callback:function(t){e.$set(e.queryMap,"validMonth",t)},expression:"queryMap.validMonth"}}),a("el-button",{staticStyle:{margin:"0 10px"},attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查詢")])],1),a("el-col",{attrs:{span:7}},[a("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-circle-plus-outline"},on:{click:e.openAdd}},[e._v("新增 ")]),a("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block",margin:"0 10px"},attrs:{action:"","http-request":e.upload,"before-upload":e.beforeUpload,accept:".xlsx","auto-upload":!0,"show-file-list":!1}},[a("el-button",{attrs:{type:"warning",size:"small"}},[a("i",{staticClass:"el-icon-upload2"}),e._v("批次上傳")])],1),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.getPriceList}},[e._v("產生報表")]),a("el-button",{staticStyle:{float:"right","margin-right":"20px"},attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downExcel}},[e._v("下載")])],1)],1),[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{"empty-text":"暫無數據",size:"mini",border:"",stripe:"",data:e.productData,height:"400"},on:{"selection-change":e.selsChange}},[a("el-table-column",{attrs:{label:"序號",type:"index",index:e.getIndex,width:"50"}}),a("el-table-column",{attrs:{prop:"twoCategoryName",label:"廢棄物小分類"}}),a("el-table-column",{attrs:{prop:"name",label:"廢棄物名稱"}}),a("el-table-column",{attrs:{prop:"price",label:"單價"}}),a("el-table-column",{attrs:{prop:"unit",label:"單位"}}),a("el-table-column",{attrs:{prop:"validMonth",label:"適用月份"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.edit(t.row.id)}}},[e._v("編輯")])],1)]}}])})],1)],a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{background:"","current-page":this.queryMap.pageNum,"page-sizes":[6,10,15,20],"page-size":this.queryMap.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("el-dialog",{attrs:{title:"新增單價維護",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[a("span",[a("el-form",{ref:"addRuleFormRef",staticClass:"demo-ruleForm",attrs:{size:"mini",model:e.addRuleForm,rules:e.addRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"廢棄物名稱",prop:"name"}},[a("el-input",{model:{value:e.addRuleForm.name,callback:function(t){e.$set(e.addRuleForm,"name",t)},expression:"addRuleForm.name"}})],1),a("el-form-item",{attrs:{label:"單價",prop:"price"}},[a("el-input",{attrs:{type:"number"},model:{value:e.addRuleForm.price,callback:function(t){e.$set(e.addRuleForm,"price",t)},expression:"addRuleForm.price"}})],1),a("el-form-item",{attrs:{label:"單位",prop:"unit"}},[a("el-select",{attrs:{placeholder:"請選擇"},model:{value:e.addRuleForm.unit,callback:function(t){e.$set(e.addRuleForm,"unit",t)},expression:"addRuleForm.unit"}},[a("el-option",{attrs:{label:"KG",value:"KG"}}),a("el-option",{attrs:{label:"批",value:"批"}})],1)],1),a("el-form-item",{attrs:{label:"適用月份",prop:"validMonth"}},[a("el-date-picker",{attrs:{type:"month",placeholder:"選擇適用月份","value-format":"yyyy-MM"},model:{value:e.addRuleForm.validMonth,callback:function(t){e.$set(e.addRuleForm,"validMonth",t)},expression:"addRuleForm.validMonth"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.btnDisabled,loading:e.btnLoading},on:{click:e.add}},[e._v("確 定")])],1)]),a("el-dialog",{attrs:{title:"編輯單價維護",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.closeEditDialog}},[a("span",[a("el-form",{ref:"editRuleFormRef",staticClass:"demo-ruleForm",attrs:{size:"mini",model:e.editRuleForm,rules:e.addRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"分類",prop:"categoryKeys"}},[a("el-cascader",{attrs:{placeholder:"請選擇",options:e.cateories,clearable:"",filterable:"",disabled:"",props:e.selectProps},model:{value:e.editRuleForm.categoryKeys,callback:function(t){e.$set(e.editRuleForm,"categoryKeys",t)},expression:"editRuleForm.categoryKeys"}})],1),a("el-form-item",{attrs:{label:"廢棄物名稱",prop:"name"}},[a("el-input",{attrs:{disabled:""},model:{value:e.editRuleForm.name,callback:function(t){e.$set(e.editRuleForm,"name",t)},expression:"editRuleForm.name"}})],1),a("el-form-item",{attrs:{label:"單價",prop:"price"}},[a("el-input",{attrs:{type:"number"},model:{value:e.editRuleForm.price,callback:function(t){e.$set(e.editRuleForm,"price",t)},expression:"editRuleForm.price"}})],1),a("el-form-item",{attrs:{label:"單位",prop:"unit"}},[a("el-select",{attrs:{disabled:"",placeholder:"請選擇"},model:{value:e.editRuleForm.unit,callback:function(t){e.$set(e.editRuleForm,"unit",t)},expression:"editRuleForm.unit"}},[a("el-option",{attrs:{label:"KG",value:"KG"}}),a("el-option",{attrs:{label:"批",value:"批"}})],1)],1),a("el-form-item",{attrs:{label:"適用月份",prop:"validMonth"}},[a("el-date-picker",{attrs:{type:"month",placeholder:"選擇適用月份","value-format":"yyyy-MM",disabled:""},model:{value:e.editRuleForm.validMonth,callback:function(t){e.$set(e.editRuleForm,"validMonth",t)},expression:"editRuleForm.validMonth"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.btnDisabled,loading:e.btnLoading},on:{click:e.update}},[e._v("確 定")])],1)])],2)],1)},i=[],n=a("1da1"),s=(a("b0c0"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("159b"),a("96cf"),a("bc3a")),o=a.n(s),l={data:function(){return{sels:[],costCenters:[],costCenterId:"",uploadApi:this.BASE_API_URL+"system/upload/image",btnLoading:!1,btnDisabled:!1,loading:!0,headerObject:{Authorization:LocalStorage.get(LOCAL_KEY_XINGUAN_ACCESS_TOKEN)},cateories:[],selectProps:{expandTrigger:"hover",value:"id",label:"name",children:"children",checkStrictly:!1},searchSelectProps:{expandTrigger:"hover",value:"id",label:"name",children:"children",checkStrictly:!0},editDialogVisible:!1,addDialogVisible:!1,costCenterDialogVisible:!1,total:0,productData:[],queryMap:{pageNum:1,pageSize:6,name:"",categoryId:"",supplier:"",status:"",validMonth:""},addRuleForm:{},editRuleForm:{},uploadDisabled:!1,limitCount:1,dialogImageUrl:"",dialogVisible:!1,addRules:{name:[{required:!0,message:"請輸入廢棄物名稱",trigger:"blur"}],unit:[{required:!0,message:"請輸入單位",trigger:"blur"}],price:[{required:!0,message:"請輸入單價",trigger:"blur"}],categorys:[{required:!0,message:"請輸入廢棄物分類",trigger:"blur"}],categoryKeys:[{required:!0,message:"請選擇廢棄物分類",trigger:"blur"}],validMonth:[{required:!0,message:"請選擇適用月份",trigger:"blur"}]},imgFilesList:[],categorykeys:[]}},computed:{lastMonth:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth();return 0==a&&(t-=1,a=12),t+"-"+a}},methods:{getIndex:function(e){return(this.queryMap.pageNum-1)*this.queryMap.pageSize+e+1},resetForm:function(){this.queryMap={pageNum:1,pageSize:5,name:"",categoryId:"",supplier:"",status:0}},openAdd:function(){this.getCatetorys(),this.addDialogVisible=!0},search:function(){this.queryMap.pageNum=1,this.getPriceList()},update:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.editRuleFormRef.validate(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(a){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=4;break}return t.abrupt("return");case 4:return e.btnDisabled=!0,e.btnLoading=!0,t.next=8,e.$http.put("business/productPrice/update/"+e.editRuleForm.id,e.editRuleForm);case 8:if(r=t.sent,i=r.data,!i.success){t.next=17;break}return e.$notify({title:"成功",message:"廢棄物單價信息更新",type:"success"}),e.editRuleForm={},t.next=15,e.getPriceList();case 15:t.next=18;break;case 17:e.$message.error("廢棄物單價信息更新失敗:"+i.data);case 18:e.editDialogVisible=!1,e.btnDisabled=!1,e.btnLoading=!1;case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},edit:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,i,n,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.get("business/productPrice/edit/"+e);case 2:if(r=a.sent,i=r.data,!i.success){a.next=10;break}t.editRuleForm=i.data,n=i.data,t.imgFilesList.push({url:"https://www.zykhome.club/"+n.imageUrl,name:n.name,id:n.id}),a.next=11;break;case 10:return a.abrupt("return",t.$message.error("廢棄物單價信息編輯失敗"+i.data.errorMsg));case 11:s=[],s.push(i.data.oneCategoryId),s.push(i.data.twoCategoryId),t.editRuleForm.categoryKeys=s,t.editDialogVisible=!0;case 16:case"end":return a.stop()}}),a)})))()},add:function(){var e=this;this.$refs.addRuleFormRef.validate(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(a){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=4;break}return t.abrupt("return");case 4:return e.btnDisabled=!0,e.btnLoading=!0,t.next=8,e.$http.post("business/productPrice/add",e.addRuleForm);case 8:if(r=t.sent,i=r.data,!i.success){t.next=17;break}return e.$message.success("廢棄物單價新增成功"),e.addRuleForm={},t.next=15,e.getPriceList();case 15:t.next=18;break;case 17:"廢棄物名稱不存在"==i.data?e.$message.error("廢棄物單價新增失敗:"+i.data):"該筆資料已存在，請問是否覆蓋?"==i.data&&e.$confirm("該筆資料已存在，請問是否覆蓋?",{distinguishCancelAndClose:!0,confirmButtonText:"確認覆蓋",cancelButtonText:"取消",dangerouslyUseHTMLString:!0}).then(Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.addRuleForm.recover=!0,t.next=3,e.$http.post("business/productPrice/add",e.addRuleForm);case 3:if(a=t.sent,r=a.data,!r.success){t.next=12;break}return e.$message.success("廢棄物單價新增成功"),e.addRuleForm={},t.next=10,e.getPriceList();case 10:t.next=13;break;case 12:e.$message.error("廢棄物單價新增失敗:"+r.data);case 13:case"end":return t.stop()}}),t)})))).catch((function(t){"cancel"===t&&e.$message({type:"info",message:"放棄覆蓋"})}));case 18:e.addDialogVisible=!1,e.btnDisabled=!1,e.btnLoading=!1;case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getPriceList:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("business/productPrice/findProductPriceList",{params:e.queryMap});case 2:if(a=t.sent,r=a.data,r.success){t.next=8;break}return t.abrupt("return",e.$message.error("獲取廢棄物單價列表失敗"));case 8:e.total=r.data.total,e.productData=r.data.rows;case 10:case"end":return t.stop()}}),t)})))()},getCatetorys:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("business/productCategory/categoryTree");case 2:if(a=t.sent,r=a.data,r.success){t.next=8;break}return t.abrupt("return",e.$message.error("獲取廢棄物類別失敗"));case 8:e.cateories=r.data.rows;case 9:case"end":return t.stop()}}),t)})))()},changeStatus:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.put("business/productPrice/updateStatus/"+e.id+"/"+e.status);case 2:r=a.sent,i=r.data,i.success?(n=e.status?"廢棄物狀態已禁用":"廢棄物狀態已啟用",t.$notify.success({title:"操作成功",message:n})):(t.$message.error("更新廢棄物狀態失敗:"+i.data.errorMsg),e.status=!e.status);case 5:case"end":return a.stop()}}),a)})))()},handleChange:function(e,t){this.uploadDisabled=t.length>=this.limitCount},handleRemove:function(e,t){this.uploadDisabled=t.length>=this.limitCount,this.addRuleForm.imageUrl=""},handleSizeChange:function(e){this.queryMap.pageSize=e,this.getPriceList()},handleCurrentChange:function(e){this.queryMap.pageNum=e,this.getPriceList()},closeAddDialog:function(){this.$refs.addRuleFormRef.clearValidate(),this.addRuleForm={},this.$refs.upload.clearFiles()},closeEditDialog:function(){this.$refs.editRuleFormRef.clearValidate(),this.editRuleForm={},this.$refs.upload2.clearFiles(),this.imgFilesList=[]},handleSuccess:function(e,t,a){this.addRuleForm.imageUrl=e.msg},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},editHandleSuccess:function(e,t,a){this.editRuleForm.imageUrl=e.msg},selectChange:function(){for(var e="",t=0;t<this.categorykeys.length;t++)e+=this.categorykeys[t]+",";e=e.substring(0,e.length-1),this.queryMap.categorys=e},selsChange:function(e){this.sels=e},downExcel:function(){var e=this;o.a.request({url:"business/productPrice/excel",method:"post",responseType:"blob"}).then((function(t){if("application/json"===t.headers["content-type"])return e.$message.error("Subject does not have permission");var a=t.data,r=window.URL.createObjectURL(a),i=document.createElement("a");document.body.appendChild(i),i.href=r,i.download="單價列表.xls",i.click(),window.URL.revokeObjectURL(r)}))},beforeUpload:function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1),a=e.size/1024/1024;"xlsx"!==t&&this.$message.warning("只能上傳後綴是.xlsx的文件"),a>10&&this.$message.warning("文件大小不得超過10M")},upload:function(e){var t=this,a=new FormData;a.append("file",e.file),this.importExcel(a).then((function(e){if(e.data.success)t.$message({message:"文件上傳成功,請刷新頁面！ ",type:"ok"});else{var a=e.data.data;if("empty"==a.type){var r="";a.list.forEach((function(e){r=r+" "+e.name})),t.$alert(r,"廢棄物名稱不存在",{confirmButtonText:"確定",type:"error"})}if("same"==a.type){r="";a.list.forEach((function(e){r=r+"<div>"+e.validMonth+": "+e.name+" "+e.price+" "+e.unit+"</div>"})),t.$confirm(r,"廢棄物單價已存在，是否覆蓋原有資料？",{distinguishCancelAndClose:!0,confirmButtonText:"確認覆蓋",cancelButtonText:"取消",dangerouslyUseHTMLString:!0}).then(Object(n["a"])(regeneratorRuntime.mark((function e(){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http.post("business/productPrice/recover",a.entityList);case 2:if(r=e.sent,i=r.data,!i.success){e.next=10;break}console.log("success"),t.$message.success("廢棄物單價批次上傳成功"),t.getPriceList(),e.next=11;break;case 10:return e.abrupt("return",t.$message.error("廢棄物單價批次上傳失敗:"+i.data));case 11:case"end":return e.stop()}}),e)})))).catch((function(e){"cancel"===e&&t.$message({type:"info",message:"放棄覆蓋"})}))}}}),(function(e){t.$message({message:"文件上傳失敗,請刷新頁面！ ",type:"ok"})}))},importExcel:function(e){return o()({url:"/business/productPrice/import",method:"post",headers:{"Content-type":"multipart/from-data"},data:e})}},created:function(){var e=this;this.getPriceList(),this.getCatetorys(),setTimeout((function(){e.loading=!1}),500)}},c=l,u=a("2877"),d=Object(u["a"])(c,r,i,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-7c36473f.d21856bb.js.map