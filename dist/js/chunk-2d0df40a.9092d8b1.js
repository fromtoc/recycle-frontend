(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0df40a"],{"88b6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"departments"}},[a("el-breadcrumb",{staticStyle:{"padding-left":"10px","padding-bottom":"10px","font-size":"12px"},attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首頁")]),a("el-breadcrumb-item",[e._v("基本資料")]),a("el-breadcrumb-item",[e._v("公司管理")])],1),a("el-card",{staticClass:"box-card"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-input",{staticClass:"input-with-select",attrs:{size:"small",clearable:"",placeholder:"請輸入公司名稱查詢"},on:{clear:e.search},model:{value:e.queryMap.name,callback:function(t){e.$set(e.queryMap,"name",t)},expression:"queryMap.name"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1),a("div",{staticStyle:{float:"right","margin-right":"20px"}},[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"department:add",expression:"'department:add'"}],attrs:{size:"small",type:"success",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("新增")]),a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"department:export",expression:"'department:export'"}],attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downExcel}},[e._v("下載")])],1)],1),[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{"empty-text":"暫無數據",border:"",size:"small",stripe:"",data:e.departmentData,height:"460"}},[a("el-table-column",{attrs:{label:"序號",type:"index",index:e.getIndex,width:"50"}}),a("el-table-column",{attrs:{prop:"typeCodeName",label:"公司類型",width:"100"}}),a("el-table-column",{attrs:{prop:"name",label:"公司名稱",width:"120"}}),a("el-table-column",{attrs:{prop:"nickname",label:"公司簡稱",width:"70"}}),a("el-table-column",{attrs:{prop:"contact",label:"聯絡人姓名",width:"100"}}),a("el-table-column",{attrs:{prop:"phone",label:"聯絡人市話",width:"100"}}),a("el-table-column",{attrs:{prop:"cellPhone",label:"聯絡人手機",width:"100"}}),a("el-table-column",{attrs:{prop:"email",label:"E-mail郵件信箱",width:"150"}}),a("el-table-column",{attrs:{prop:"remark",label:"備註",width:"100"}}),a("el-table-column",{attrs:{prop:"isban",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.changeFood(t.row)}},model:{value:t.row.food,callback:function(a){e.$set(t.row,"food",a)},expression:"scope.row.food"}})]}}])},[a("template",{slot:"header"},[a("div",{staticStyle:{"text-align":"center"}},[e._v("辦公大樓")]),a("div",{staticStyle:{"text-align":"center"}},[e._v("餐廳廚餘標記")])])],2),a("el-table-column",{attrs:{prop:"isban",label:"停用",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.changeStatus(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}})]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"department:edit",expression:"'department:edit'"}],attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(a){return e.edit(t.row.id)}}},[e._v("編輯")])]}}])})],1)],a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{background:"","current-page":this.queryMap.pageNum,"page-sizes":[7,10,15,20],"page-size":this.queryMap.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("el-dialog",{attrs:{title:"新增公司",visible:e.addDialogVisible,width:"60%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.closeAddDialog}},[a("span",[a("el-form",{ref:"addRuleFormRef",staticClass:"demo-ruleForm",attrs:{model:e.addRuleForm,rules:e.addRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"公司類型",prop:"typeId"}},[a("el-select",{attrs:{"no-data-text":"無數據",placeholder:"請選擇公司類型"},model:{value:e.addRuleForm.typeId,callback:function(t){e.$set(e.addRuleForm,"typeId",t)},expression:"addRuleForm.typeId"}},e._l(e.departmentCategories,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"公司名稱",prop:"name"}},[a("el-input",{model:{value:e.addRuleForm.name,callback:function(t){e.$set(e.addRuleForm,"name",t)},expression:"addRuleForm.name"}})],1),a("el-form-item",{attrs:{label:"公司簡稱",prop:"nickname"}},[a("el-input",{model:{value:e.addRuleForm.nickname,callback:function(t){e.$set(e.addRuleForm,"nickname",t)},expression:"addRuleForm.nickname"}})],1),a("el-form-item",{attrs:{label:"聯絡人姓名",prop:"contact"}},[a("el-input",{model:{value:e.addRuleForm.contact,callback:function(t){e.$set(e.addRuleForm,"contact",t)},expression:"addRuleForm.contact"}})],1),a("el-form-item",{attrs:{label:"聯絡人市話",prop:"phone"}},[a("el-input",{model:{value:e.addRuleForm.phone,callback:function(t){e.$set(e.addRuleForm,"phone",t)},expression:"addRuleForm.phone"}})],1),a("el-form-item",{attrs:{label:"聯絡人手機",prop:"cellPhone"}},[a("el-input",{model:{value:e.addRuleForm.cellPhone,callback:function(t){e.$set(e.addRuleForm,"cellPhone",t)},expression:"addRuleForm.cellPhone"}})],1),a("el-form-item",{attrs:{label:"E-mail",prop:"email"}},[a("el-input",{model:{value:e.addRuleForm.email,callback:function(t){e.$set(e.addRuleForm,"email",t)},expression:"addRuleForm.email"}})],1),a("el-form-item",{attrs:{label:"備註",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.addRuleForm.remark,callback:function(t){e.$set(e.addRuleForm,"remark",t)},expression:"addRuleForm.remark"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.btnDisabled,loading:e.btnLoading},on:{click:e.add}},[e._v("確 定")])],1)]),a("el-dialog",{attrs:{title:"編輯公司",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.closeEditDialog}},[a("span",[a("el-form",{ref:"editRuleFormRef",staticClass:"demo-ruleForm",attrs:{model:e.editRuleForm,rules:e.addRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"公司類型",prop:"typeId"}},[a("el-select",{attrs:{"no-data-text":"無數據",placeholder:"請選擇公司類型"},model:{value:e.editRuleForm.typeId,callback:function(t){e.$set(e.editRuleForm,"typeId",t)},expression:"editRuleForm.typeId"}},e._l(e.departmentCategories,(function(e){return a("el-option",{key:e.id,attrs:{label:e.value,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"公司名稱",prop:"name"}},[a("el-input",{model:{value:e.editRuleForm.name,callback:function(t){e.$set(e.editRuleForm,"name",t)},expression:"editRuleForm.name"}})],1),a("el-form-item",{attrs:{label:"公司簡稱",prop:"nickname"}},[a("el-input",{model:{value:e.editRuleForm.nickname,callback:function(t){e.$set(e.editRuleForm,"nickname",t)},expression:"editRuleForm.nickname"}})],1),a("el-form-item",{attrs:{label:"聯絡人姓名",prop:"contact"}},[a("el-input",{model:{value:e.editRuleForm.contact,callback:function(t){e.$set(e.editRuleForm,"contact",t)},expression:"editRuleForm.contact"}})],1),a("el-form-item",{attrs:{label:"聯絡人市話",prop:"phone"}},[a("el-input",{model:{value:e.editRuleForm.phone,callback:function(t){e.$set(e.editRuleForm,"phone",t)},expression:"editRuleForm.phone"}})],1),a("el-form-item",{attrs:{label:"聯絡人手機",prop:"cellPhone"}},[a("el-input",{model:{value:e.editRuleForm.cellPhone,callback:function(t){e.$set(e.editRuleForm,"cellPhone",t)},expression:"editRuleForm.cellPhone"}})],1),a("el-form-item",{attrs:{label:"E-mail",prop:"email"}},[a("el-input",{model:{value:e.editRuleForm.email,callback:function(t){e.$set(e.editRuleForm,"email",t)},expression:"editRuleForm.email"}})],1),a("el-form-item",{attrs:{label:"備註",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.editRuleForm.remark,callback:function(t){e.$set(e.editRuleForm,"remark",t)},expression:"editRuleForm.remark"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.btnDisabled,loading:e.btnLoading},on:{click:e.update}},[e._v("確 定")])],1)])],2)],1)},n=[],i=a("1da1"),l=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("bc3a")),s=a.n(l),o={data:function(){return{departmentCategories:[],btnLoading:!1,btnDisabled:!1,loading:!0,editDialogVisible:!1,addDialogVisible:!1,total:0,departmentData:[],queryMap:{pageNum:1,pageSize:7,name:""},addRuleForm:{},editRuleForm:{},addRules:{typeId:[{required:!0,message:"請選擇公司類型",trigger:"blur"}],name:[{required:!0,message:"請輸入公司名稱",trigger:"blur"}],nickname:[{required:!0,message:"請輸入公司簡稱",trigger:"blur"}]}}},methods:{getIndex:function(e){return(this.queryMap.pageNum-1)*this.queryMap.pageSize+e+1},downExcel:function(){var e=this;s.a.request({url:"system/department/excel",method:"post",responseType:"blob"}).then((function(t){if("application/json"===t.headers["content-type"])return e.$message.error("Subject does not have permission [department:export]");var a=t.data,r=window.URL.createObjectURL(a),n=document.createElement("a");document.body.appendChild(n),n.href=r,n.download="公司列表.xls",n.click(),window.URL.revokeObjectURL(r)}))},search:function(){this.queryMap.pageNum=1,this.getDepartmentList()},del:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r,n,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$confirm("此操作將永久删除該用戶, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).catch((function(){i.$message({type:"info",message:"已取消删除"})}));case 2:if(a=e.sent,"confirm"!==a){e.next=15;break}return e.next=6,this.$http.delete("system/department/delete/"+t);case 6:if(r=e.sent,n=r.data,!n.success){e.next=14;break}return this.$message.success("公司删除成功"),e.next=12,this.getDepartmentList();case 12:e.next=15;break;case 14:this.$message.error(n.data.errorMsg);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),update:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.editRuleFormRef.validate(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=4;break}return e.abrupt("return");case 4:return t.btnLoading=!0,t.btnDisabled=!0,e.next=7,t.$http.put("system/department/update/"+t.editRuleForm.id,t.editRuleForm);case 7:if(r=e.sent,n=r.data,!n.success){e.next=15;break}return t.$notify({title:"成功",message:"公司信息更新",type:"success"}),e.next=13,t.getDepartmentList();case 13:e.next=16;break;case 15:t.$message.error("公司信息更新失敗");case 16:t.editRuleForm={},t.btnDisabled=!1,t.btnLoading=!1,t.editDialogVisible=!1;case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),edit:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$http.get("system/department/edit/"+t);case 2:if(a=e.sent,r=a.data,!r.success){e.next=8;break}this.editRuleForm=r.data,e.next=9;break;case 8:return e.abrupt("return",this.$message.error("公司信息編輯失敗"+r.data.errorMsg));case 9:this.editDialogVisible=!0;case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),add:function(){var e=this;this.$refs.addRuleFormRef.validate(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a){t.next=4;break}return t.abrupt("return");case 4:return e.btnLoading=!0,e.btnDisabled=!0,t.next=7,e.$http.post("system/department/add",e.addRuleForm);case 7:if(r=t.sent,n=r.data,!n.success){t.next=16;break}return e.$message.success("公司新增成功"),e.addRuleForm={},t.next=14,e.getDepartmentList();case 14:t.next=17;break;case 16:return t.abrupt("return",e.$message.error("公司新增失敗:"+n.data.errorMsg));case 17:e.addDialogVisible=!1,e.btnLoading=!1,e.btnDisabled=!1;case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getDepartmentList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("system/department/findDepartmentList",{params:e.queryMap});case 2:if(a=t.sent,r=a.data,r.success){t.next=8;break}return t.abrupt("return",e.$message.error("獲取用戶列表失敗:"+r.data.errorMsg));case 8:e.total=r.data.total,e.departmentData=r.data.rows;case 10:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.queryMap.pageSize=e,this.getDepartmentList()},handleCurrentChange:function(e){this.queryMap.pageNum=e,this.getDepartmentList()},closeAddDialog:function(){this.$refs.addRuleFormRef.clearValidate(),this.addRuleForm={}},closeEditDialog:function(){this.$refs.editRuleFormRef.clearValidate(),this.editRuleForm={}},getDepartmentCategory:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("system/departmentCategory/findAll");case 2:if(a=t.sent,r=a.data,r.success){t.next=6;break}return t.abrupt("return",e.$message.error("獲取公司類別失敗:"+r.data.errorMsg));case 6:e.departmentCategories=r.data;case 7:case"end":return t.stop()}}),t)})))()},changeStatus:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.put("system/department/updateStatus/"+e.id+"/"+e.status);case 2:r=a.sent,n=r.data,n.success?(i=e.status?"公司狀態已禁用":"公司狀態已啟用",t.$notify.success({title:"操作成功",message:i})):(t.$message.error("更新公司狀態失敗:"+n.data.errorMsg),e.status=!e.status);case 5:case"end":return a.stop()}}),a)})))()},changeFood:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.put("system/department/updateFood/"+e.id+"/"+e.food);case 2:r=a.sent,n=r.data,n.success?(i=e.food?"增加廚餘標記":"移除廚餘標記",t.$notify.success({title:"操作成功",message:i})):(t.$message.error("更新廚餘標記失敗:"+n.data.errorMsg),e.food=!e.food);case 5:case"end":return a.stop()}}),a)})))()}},created:function(){var e=this;this.getDepartmentList(),this.getDepartmentCategory(),setTimeout((function(){e.loading=!1}),500)}},u=o,d=a("2877"),c=Object(d["a"])(u,r,n,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d0df40a.9092d8b1.js.map