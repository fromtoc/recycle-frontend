(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69ae1c72"],{"159b":function(e,t,r){var a=r("da84"),n=r("fdbc"),o=r("785a"),i=r("17c2"),s=r("9112"),l=function(e){if(e&&e.forEach!==i)try{s(e,"forEach",i)}catch(t){e.forEach=i}};for(var c in n)n[c]&&l(a[c]&&a[c].prototype);l(o)},"17c2":function(e,t,r){"use strict";var a=r("b727").forEach,n=r("a640"),o=n("forEach");e.exports=o?[].forEach:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}},"99af":function(e,t,r){"use strict";var a=r("23e7"),n=r("d039"),o=r("e8b5"),i=r("861d"),s=r("7b0b"),l=r("07fa"),c=r("8418"),d=r("65f0"),u=r("1dde"),p=r("b622"),m=r("2d00"),f=p("isConcatSpreadable"),g=9007199254740991,b="Maximum allowed index exceeded",h=m>=51||!n((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),v=u("concat"),x=function(e){if(!i(e))return!1;var t=e[f];return void 0!==t?!!t:o(e)},w=!h||!v;a({target:"Array",proto:!0,forced:w},{concat:function(e){var t,r,a,n,o,i=s(this),u=d(i,0),p=0;for(t=-1,a=arguments.length;t<a;t++)if(o=-1===t?i:arguments[t],x(o)){if(n=l(o),p+n>g)throw TypeError(b);for(r=0;r<n;r++,p++)r in o&&c(u,p,o[r])}else{if(p>=g)throw TypeError(b);c(u,p++,o)}return u.length=p,u}})},a640:function(e,t,r){"use strict";var a=r("d039");e.exports=function(e,t){var r=[][e];return!!r&&a((function(){r.call(null,t||function(){throw 1},1)}))}},f982:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"roles"}},[r("el-breadcrumb",{staticStyle:{"padding-left":"10px","padding-bottom":"10px","font-size":"12px"},attrs:{separator:"/"}},[r("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首頁")]),r("el-breadcrumb-item",[e._v("權限管理")]),r("el-breadcrumb-item",[e._v("角色權限")])],1),r("el-card",{staticClass:"box-card"},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:8}},[r("el-input",{staticClass:"input-with-select",attrs:{clearable:"",size:"small",placeholder:"請輸入角色名查詢"},on:{clear:e.getRoleList},model:{value:e.queryMap.roleName,callback:function(t){e.$set(e.queryMap,"roleName",t)},expression:"queryMap.roleName"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1),r("div",{staticStyle:{float:"right","margin-right":"20px"}},[r("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"role:add",expression:"'role:add'"}],attrs:{size:"small",type:"success",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("新增")]),r("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"role:export",expression:"'role:export'"}],attrs:{size:"small",icon:"el-icon-download"},on:{click:e.downExcel}},[e._v("下載")])],1)],1),[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{"empty-text":"暫無數據",data:e.roleData,border:"",height:"470",size:"small"}},[r("el-table-column",{attrs:{label:"序號",type:"index",width:"50"}}),r("el-table-column",{attrs:{prop:"roleName",label:"角色名稱",width:"180"}}),r("el-table-column",{attrs:{prop:"modifiedTime",label:"最後修改時間",width:"150"}}),r("el-table-column",{attrs:{prop:"type",formatter:e.showSex,label:"資料權限",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.type?r("el-tag",{attrs:{size:"small",type:"warning"}},[e._v("限本帳號")]):r("el-tag",{attrs:{size:"small",type:"success"}},[e._v("所有資料")])]}}])}),r("el-table-column",{attrs:{prop:"remark",label:"備註"}}),r("el-table-column",{attrs:{prop:"isban",label:"停用",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{on:{change:function(r){return e.changRoleStatus(t.row)}},model:{value:t.row.status,callback:function(r){e.$set(t.row,"status",r)},expression:"scope.row.status"}})]}}])}),r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",icon:"el-icon-present",size:"small"},on:{click:function(r){return e.grant(t.row.id)}}},[e._v("授權")]),r("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"role:edit",expression:"'role:edit'"}],attrs:{type:"text",icon:"el-icon-edit",size:"small"},on:{click:function(r){return e.edit(t.row.id)}}},[e._v("編輯")])]}}])})],1)],r("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{background:"","current-page":e.queryMap.pageNum,"page-sizes":[8,16,32,64],"page-size":e.queryMap.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),r("el-dialog",{attrs:{title:"新增角色權限",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t},close:e.closeAdd}},[r("el-form",{ref:"addFormRef",attrs:{model:e.addForm,"label-width":"80px",rules:e.addFormRoles}},[r("el-form-item",{attrs:{label:"角色名稱",prop:"roleName"}},[r("el-input",{model:{value:e.addForm.roleName,callback:function(t){e.$set(e.addForm,"roleName",t)},expression:"addForm.roleName"}})],1),r("div",{staticClass:"grid-content bg-purple-light"},[r("el-form-item",{attrs:{label:"資料權限",prop:"type"}},[r("el-radio-group",{model:{value:e.addForm.type,callback:function(t){e.$set(e.addForm,"type",t)},expression:"addForm.type"}},[r("el-radio",{attrs:{label:0}},[e._v("所有資料")]),r("el-radio",{attrs:{label:1}},[e._v("限本帳號")])],1)],1)],1),r("el-form-item",{attrs:{label:"描述信息",prop:"remark"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary",loading:e.btnLoading,disabled:e.btnDisabled},on:{click:e.addRole}},[e._v("確 定")])],1)],1),r("el-dialog",{attrs:{title:"編輯角色權限",visible:e.editDialogVisible,width:"50%"},on:{"update:visible":function(t){e.editDialogVisible=t},close:e.closeEdit}},[r("el-form",{ref:"editFormRef",attrs:{model:e.editForm,"label-width":"80px",rules:e.addFormRoles}},[r("el-form-item",{attrs:{label:"角色名稱",prop:"roleName"}},[r("el-input",{model:{value:e.editForm.roleName,callback:function(t){e.$set(e.editForm,"roleName",t)},expression:"editForm.roleName"}})],1),r("div",{staticClass:"grid-content bg-purple-light"},[r("el-form-item",{attrs:{label:"資料權限",prop:"type"}},[r("el-radio-group",{model:{value:e.editForm.type,callback:function(t){e.$set(e.editForm,"type",t)},expression:"editForm.type"}},[r("el-radio",{attrs:{label:0}},[e._v("所有資料")]),r("el-radio",{attrs:{label:1}},[e._v("限本帳號")])],1)],1)],1),r("el-form-item",{attrs:{label:"描述信息",prop:"remark"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.editForm.remark,callback:function(t){e.$set(e.editForm,"remark",t)},expression:"editForm.remark"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary",loading:e.btnLoading,disabled:e.btnDisabled},on:{click:e.updateRole}},[e._v("確 定")])],1)],1),r("el-dialog",{attrs:{title:"分配選單權限",visible:e.grantDialogVisible,width:"38%"},on:{"update:visible":function(t){e.grantDialogVisible=t}}},[r("span",[r("el-tree",{ref:"tree",attrs:{"auto-expand-parent":!1,data:e.data,"show-checkbox":"","node-key":"id","default-expanded-keys":e.open,props:e.defaultProps,"highlight-current":""},on:{"check-change":e.checkChange}})],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.grantDialogVisible=!1}}},[e._v("取 消")]),r("el-button",{directives:[{name:"hasPermission",rawName:"v-hasPermission",value:"role:authority",expression:"'role:authority'"}],attrs:{type:"primary",icon:"el-icon-setting",loading:e.btnLoading,disabled:e.btnDisabled},on:{click:e.authority}},[e._v("授 權")])],1)])],2)],1)},n=[],o=r("1da1"),i=(r("96cf"),r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),r("9861"),r("99af"),r("159b"),r("bc3a")),s=r.n(i),l={data:function(){return{btnLoading:!1,btnDisabled:!1,loading:!0,total:0,queryMap:{roleName:"",pageNum:1,pageSize:8},roleData:[],addForm:{type:0},editForm:{},addDialogVisible:!1,editDialogVisible:!1,grantDialogVisible:!1,data:[],open:[],grantId:"",defaultProps:{children:"children",label:"menuName"},addFormRoles:{roleName:[{required:!0,message:"請輸入角色名稱",trigger:"blur"}],type:[{required:!0,message:"請選擇資料權限",trigger:"blur"}]}}},methods:{checkChange:function(e,t,r){var a=this.$refs.tree.getNode(e);!a.checked&&this.findchildren(a.parent)},findchildren:function(e){var t=this.$refs.tree.getNode(e);t.isLeaf||(t.indeterminate=!0,t.checked=!0)},downExcel:function(){var e=this;s.a.request({url:"system/role/excel",method:"post",responseType:"blob"}).then((function(t){if("application/json"===t.headers["content-type"])return e.$message.error("Subject does not have permission [role:export]");var r=t.data,a=window.URL.createObjectURL(r),n=document.createElement("a");document.body.appendChild(n),n.href=a,n.download="角色列表.xls",n.click(),window.URL.revokeObjectURL(a)}))},authority:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btnDisabled=!0,e.btnLoading=!0,t.next=4,e.$http.post("system/role/authority/"+e.grantId,[].concat(e.$refs.tree.getCheckedKeys(),e.$refs.tree.getHalfCheckedKeys()));case 4:r=t.sent,a=r.data,a.success?e.$message.success("角色授權成功"):e.$message.error("角色授權失敗:"+a.data.errorMsg),e.btnDisabled=!1,e.btnLoading=!1,e.grantDialogVisible=!1;case 10:case"end":return t.stop()}}),t)})))()},grant:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.get("system/role/findRoleMenu/"+e);case 2:a=r.sent,n=a.data,n.success&&(o=t,setTimeout((function(){n.data.mids.forEach((function(e){o.$refs.tree.setChecked(e,!0,!1)}))}),100),t.data=n.data.tree,t.open=n.data.open,t.grantId=e),t.grantDialogVisible=!0;case 6:case"end":return r.stop()}}),r)})))()},getRoleList:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("system/role/findRoleList",{params:e.queryMap});case 2:r=t.sent,a=r.data,a.success&&(e.roleData=a.data.rows,e.total=a.data.total);case 5:case"end":return t.stop()}}),t)})))()},search:function(){this.queryMap.pageNum=1,this.getRoleList()},closeAdd:function(){this.$refs.addFormRef.clearValidate(),this.addForm={type:0}},closeEdit:function(){this.$refs.editFormRef.clearValidate(),this.editForm={}},addRole:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.addFormRef.validate(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=4;break}return t.abrupt("return");case 4:return e.btnDisabled=!0,e.btnLoading=!0,t.next=8,e.$http.post("system/role/add",e.addForm);case 8:if(a=t.sent,n=a.data,!n.success){t.next=20;break}return e.$message.success("新增成功"),e.addDialogVisible=!1,e.btnDisabled=!1,e.btnLoading=!1,e.addForm={},t.next=18,e.getRoleList();case 18:t.next=21;break;case 20:return t.abrupt("return",e.$message.error("角色新增失敗:"+n.data.errorMsg));case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},edit:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.get("system/role/edit/"+e);case 2:if(a=r.sent,n=a.data,!n.success){r.next=9;break}t.editForm=n.data,t.editDialogVisible=!0,r.next=10;break;case 9:return r.abrupt("return",t.$message.error("角色編輯失敗:"+n.data.errorMsg));case 10:case"end":return r.stop()}}),r)})))()},updateRole:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.editFormRef.validate(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=4;break}return t.abrupt("return");case 4:return e.btnDisabled=!0,e.btnLoading=!0,t.next=8,e.$http.put("system/role/update/"+e.editForm.id,e.editForm);case 8:if(a=t.sent,n=a.data,!n.success){t.next=16;break}return e.$notify({title:"成功",message:"角色信息更新",type:"success"}),t.next=14,e.getRoleList();case 14:t.next=17;break;case 16:e.$message.error("角色信息更新失敗:"+n.data.errorMsg);case 17:e.editDialogVisible=!1,e.btnDisabled=!1,e.btnLoading=!1,e.editForm={};case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},del:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$confirm("此操作將永久删除該角色, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).catch((function(){t.$message({type:"info",message:"已取消删除"})}));case 2:if(a=r.sent,"confirm"!==a){r.next=16;break}return r.next=6,t.$http.delete("system/role/delete/"+e);case 6:if(n=r.sent,o=n.data,console.log(o),!o.success){r.next=15;break}return t.$message.success("删除成功"),r.next=13,t.getRoleList();case 13:r.next=16;break;case 15:t.$message.error("删除失敗:"+o.data.errorMsg);case 16:case"end":return r.stop()}}),r)})))()},changRoleStatus:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.put("system/role/updateStatus/"+e.id+"/"+e.status);case 2:a=r.sent,n=a.data,n.success?(o=e.status?"角色狀態已禁用":"角色狀態已啟用",t.$notify.success({title:"操作成功",message:o})):(t.$message.error("更新角色狀態失敗:"+n.data.errorMsg),e.status=!e.status);case 5:case"end":return r.stop()}}),r)})))()},handleSizeChange:function(e){this.queryMap.pageSize=e,this.getRoleList()},handleCurrentChange:function(e){this.queryMap.pageNum=e,this.getRoleList()}},created:function(){var e=this;this.getRoleList(),setTimeout((function(){e.loading=!1}),500)}},c=l,d=r("2877"),u=Object(d["a"])(c,a,n,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-69ae1c72.48fa679e.js.map